version: '3.8'

services:
  # File Manager API Services
  file-manager-api-dev:
    build:
      context: ../..
      dockerfile: projects/file-manager-api/docker/Dockerfile
      target: development
    ports:
      - "8001:8000"
    volumes:
      - ../..:/app
      - /app/__pycache__
      - /app/.pytest_cache
      - /app/projects/file-manager-api/.venv
    environment:
      - PYTHONUNBUFFERED=1
      - APP_ENV=development
    working_dir: /app/projects/file-manager-api

  file-manager-api-prod:
    build:
      context: ../..
      dockerfile: projects/file-manager-api/docker/Dockerfile.prod
      target: production
    ports:
      - "8080:8000"
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped

  file-manager-api-test:
    build:
      context: ../..
      dockerfile: projects/file-manager-api/docker/Dockerfile
      target: development
    volumes:
      - ../..:/app
      - /app/__pycache__
      - /app/.pytest_cache
    environment:
      - PYTHONUNBUFFERED=1
      - APP_ENV=testing
    working_dir: /app/projects/file-manager-api
    command: pytest -v

  # Bot Knowledge Services
  bot-knowledge-dev:
    build:
      context: ../../projects/bot-knowledge
      dockerfile: Dockerfile
      target: development
    ports:
      - "8002:8000"
    volumes:
      - ../../projects/bot-knowledge:/app
      - /app/__pycache__
      - /app/.pytest_cache
      - /app/.venv
      - ../../projects/bot-knowledge/chroma_db:/app/chroma_db
    environment:
      - PYTHONUNBUFFERED=1
      - APP_ENV=development
      - CHROMA_PERSIST_DIRECTORY=/app/chroma_db
      - DEBUG_MODE=true
      - RELOAD=true

  bot-knowledge-prod:
    build:
      context: ../../projects/bot-knowledge
      dockerfile: Dockerfile.prod
      target: production
    ports:
      - "8081:8000"
    environment:
      - PYTHONUNBUFFERED=1
      - CHROMA_PERSIST_DIRECTORY=/app/chroma_db
    restart: unless-stopped

  bot-knowledge-test:
    build:
      context: ../../projects/bot-knowledge
      dockerfile: Dockerfile
      target: development
    volumes:
      - ../../projects/bot-knowledge:/app
      - /app/__pycache__
      - /app/.pytest_cache
    environment:
      - PYTHONUNBUFFERED=1
      - APP_ENV=testing
    command: pytest -v

  # Project Three Services (Commented out - uncomment when ready to use)
  # project-three-dev:
  #   build:
  #     context: ../../projects/project-three
  #     dockerfile: docker/Dockerfile
  #     target: development
  #   ports:
  #     - "8003:8000"
  #   volumes:
  #     - ../../projects/project-three:/app
  #     - /app/__pycache__
  #     - /app/.pytest_cache
  #     - /app/.venv
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - APP_ENV=development

  # project-three-prod:
  #   build:
  #     context: ../../projects/project-three
  #     dockerfile: docker/Dockerfile.prod
  #     target: production
  #   ports:
  #     - "8082:8000"
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #   restart: unless-stopped

  # project-three-test:
  #   build:
  #     context: ../../projects/project-three
  #     dockerfile: docker/Dockerfile
  #     target: development
  #   volumes:
  #     - ../../projects/project-three:/app
  #     - /app/__pycache__
  #     - /app/.pytest_cache
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - APP_ENV=testing
  #   command: pytest -v